# 栈

栈是一种LIFO形式的**数据结构**，所有的数据都是后进先出。
栈是由高地址向低地址生长的一块连续的内存区域，栈顶地址和栈的最大容量都是系统预先规定好的。

栈支持两种基本操作，push和pop。push将数据压入栈中，pop将栈中的数据弹出并存储到指定寄存器或者内存中。

## 1. 调用栈

call stack

在计算科学中，调用栈是指一种栈数据结构，用于存储有关计算机程序的活动子例程的信息。

程序的执行过程可看作连续的函数调用。当一个函数执行完毕时，程序要回到调用该函数的下一条指令处继续执行。函数调用过程通常使用栈实现，每个用户态进程对应一个**调用栈**结构(call stack)。编译器使用栈传递函数参数、保存返回地址、临时保存寄存器原有值(即函数调用的上下文)以备恢复以及存储本地局部变量。

使用栈的原因：

- 因栈这种数据结构正好能够满足调用函数的方式：父函数调用子函数，父函数在前，子函数在后；返回时，子函数先返回，父函数后返回。
- 在函数调用过程中，我们将调用函数的函数称为“调用者(caller)”，将被调用的函数称为“被调用者(callee)”。在这个过程中，1）“调用者”需要知道在哪里获取“被调用者”返回的值；2）“被调用者”需要知道传入的参数在哪里，以及返回的地址在哪里。因此，需要使用栈来保存这些数据。

注意：调用另一个函数时，当前函数暂停并处于未完成状态。

## 2. 栈帧

stack frames

调用栈由栈帧组成，栈帧也被称作 “活动记录” (activation records) 或 活动帧(activation frames) 。

函数调用经常是嵌套的，在同一时刻，堆栈中会有多个函数的信息。每个未完成运行的函数都会占用一个独立的连续区域，称作栈帧(Stack Frame)。所以整个栈空间中可能会同时存在多个栈帧。

栈帧是堆栈的逻辑片段，当调用函数时逻辑栈帧被压入堆栈，当函数返回时逻辑栈帧被从堆栈中弹出。栈帧存放着函数参数，局部变量及恢复前一栈帧所需要的数据等。

注意：每个函数调用都用自己的变量，在一个函数调用中不能访问另一个函数中的同名变量。

## 参考

- https://en.wikipedia.org/wiki/Call_stack
- [C语言函数调用栈(一)](http://www.cnblogs.com/clover-toeic/p/3755401.html)
- [C语言函数调用栈(二)](http://www.cnblogs.com/clover-toeic/p/3756668.html)
- [C函数调用过程原理及函数栈帧分析](https://segmentfault.com/a/1190000007977460)